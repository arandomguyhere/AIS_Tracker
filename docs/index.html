<!DOCTYPE html>
<html lang="en">
<head>
    <!-- OSINT data last updated: 2025-12-27T22:58:34.376439Z -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arsenal Ship Tracker</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: #1a1a2e;
            height: 100vh;
            overflow: hidden;
        }

        /* Full screen map */
        #map {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            z-index: 1;
        }

        /* Top bar */
        .top-bar {
            position: absolute;
            top: 0; left: 0; right: 0;
            height: 56px;
            background: linear-gradient(180deg, rgba(26,26,46,0.95) 0%, rgba(26,26,46,0.85) 100%);
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            padding: 0 16px;
            gap: 16px;
            z-index: 1000;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            color: white;
            font-weight: 600;
            font-size: 18px;
            white-space: nowrap;
        }

        .logo-icon {
            width: 36px; height: 36px;
            background: linear-gradient(135deg, #e94560 0%, #c23a51 100%);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 16px;
        }

        .search-container {
            flex: 1;
            max-width: 500px;
            position: relative;
        }

        .search-input {
            width: 100%;
            padding: 10px 16px 10px 42px;
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 8px;
            background: rgba(255,255,255,0.1);
            color: white;
            font-size: 14px;
            outline: none;
            transition: all 0.2s;
        }

        .search-input::placeholder { color: rgba(255,255,255,0.5); }
        .search-input:focus {
            background: rgba(255,255,255,0.15);
            border-color: #e94560;
        }

        .search-icon {
            position: absolute;
            left: 14px;
            top: 50%;
            transform: translateY(-50%);
            color: rgba(255,255,255,0.5);
        }

        .search-results {
            position: absolute;
            top: 100%;
            left: 0; right: 0;
            background: #1a1a2e;
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 8px;
            margin-top: 4px;
            max-height: 300px;
            overflow-y: auto;
            display: none;
        }

        .search-results.active { display: block; }

        .search-result-item {
            padding: 12px 16px;
            cursor: pointer;
            border-bottom: 1px solid rgba(255,255,255,0.05);
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .search-result-item:hover { background: rgba(255,255,255,0.05); }
        .search-result-item:last-child { border-bottom: none; }

        .result-icon {
            width: 32px; height: 32px;
            background: rgba(233,69,96,0.2);
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .result-info { flex: 1; }
        .result-name { color: white; font-weight: 500; font-size: 14px; }
        .result-meta { color: rgba(255,255,255,0.5); font-size: 12px; margin-top: 2px; }

        .stats-bar {
            display: flex;
            gap: 20px;
            margin-left: auto;
        }

        .stat {
            text-align: center;
            color: white;
        }

        .stat-value {
            font-size: 18px;
            font-weight: 700;
        }

        .stat-label {
            font-size: 10px;
            color: rgba(255,255,255,0.5);
            text-transform: uppercase;
        }

        .stat-critical .stat-value { color: #e94560; }
        .stat-warning .stat-value { color: #f39c12; }
        .stat-info .stat-value { color: #3498db; }

        /* Control buttons */
        .map-controls {
            position: absolute;
            top: 72px;
            right: 16px;
            display: flex;
            flex-direction: column;
            gap: 8px;
            z-index: 1000;
        }

        .control-btn {
            width: 40px; height: 40px;
            background: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
            transition: all 0.2s;
            font-size: 18px;
        }

        .control-btn:hover {
            background: #f8f9fa;
            transform: scale(1.05);
        }

        .control-btn.active {
            background: #e94560;
            color: white;
        }

        /* Vessel panel (slide-in from right) */
        .vessel-panel {
            position: absolute;
            top: 56px;
            right: 0;
            width: 380px;
            height: calc(100vh - 56px);
            background: white;
            box-shadow: -4px 0 20px rgba(0,0,0,0.15);
            z-index: 999;
            transform: translateX(100%);
            transition: transform 0.3s ease;
            overflow-y: auto;
        }

        .vessel-panel.active { transform: translateX(0); }

        .panel-header {
            padding: 20px;
            background: linear-gradient(135deg, #1a1a2e 0%, #2d2d44 100%);
            color: white;
            position: relative;
        }

        .panel-close {
            position: absolute;
            top: 16px;
            right: 16px;
            background: rgba(255,255,255,0.1);
            border: none;
            color: white;
            width: 32px; height: 32px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .panel-close:hover { background: rgba(255,255,255,0.2); }

        .vessel-icon-large {
            width: 48px; height: 48px;
            background: rgba(233,69,96,0.2);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 12px;
        }

        .vessel-name {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .vessel-type {
            font-size: 13px;
            color: rgba(255,255,255,0.7);
        }

        .threat-indicator {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            margin-top: 12px;
        }

        .threat-critical { background: #e94560; }
        .threat-high { background: #f39c12; }
        .threat-medium { background: #3498db; }
        .threat-low { background: #27ae60; }
        .threat-unknown { background: #95a5a6; }

        .panel-section {
            padding: 20px;
            border-bottom: 1px solid #eee;
        }

        .section-title {
            font-size: 12px;
            font-weight: 600;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 16px;
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #f5f5f5;
        }

        .info-row:last-child { border-bottom: none; }
        .info-label { color: #666; font-size: 13px; }
        .info-value { font-weight: 500; font-size: 13px; color: #333; }

        .position-display {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 16px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }

        .coord-box {
            text-align: center;
        }

        .coord-label {
            font-size: 11px;
            color: #666;
            text-transform: uppercase;
        }

        .coord-value {
            font-size: 18px;
            font-weight: 600;
            color: #333;
            font-family: 'Monaco', 'Consolas', monospace;
        }

        .intel-box {
            background: #fff8e1;
            border-left: 4px solid #f39c12;
            padding: 12px;
            border-radius: 0 8px 8px 0;
            font-size: 13px;
            color: #666;
            line-height: 1.6;
        }

        .weapons-grid {
            display: grid;
            gap: 8px;
        }

        .weapon-item {
            background: #fee;
            border-radius: 6px;
            padding: 10px 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .weapon-name { color: #c0392b; font-size: 12px; }
        .weapon-value { font-weight: 600; color: #333; font-size: 13px; }

        .action-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            padding: 20px;
        }

        .action-btn {
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.2s;
        }

        .action-btn-primary {
            background: #e94560;
            color: white;
        }

        .action-btn-primary:hover { background: #d63850; }

        .action-btn-secondary {
            background: #f8f9fa;
            color: #333;
            border: 1px solid #ddd;
        }

        .action-btn-secondary:hover { background: #eee; }

        /* Timeline */
        .timeline {
            position: relative;
            padding-left: 24px;
        }

        .timeline::before {
            content: '';
            position: absolute;
            left: 8px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: #eee;
        }

        .timeline-item {
            position: relative;
            padding-bottom: 20px;
        }

        .timeline-item:last-child { padding-bottom: 0; }

        .timeline-dot {
            position: absolute;
            left: -20px;
            top: 2px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #e94560;
            border: 2px solid white;
            box-shadow: 0 0 0 2px #e94560;
        }

        .timeline-dot.severity-high { background: #f39c12; box-shadow: 0 0 0 2px #f39c12; }
        .timeline-dot.severity-medium { background: #3498db; box-shadow: 0 0 0 2px #3498db; }
        .timeline-dot.severity-info { background: #95a5a6; box-shadow: 0 0 0 2px #95a5a6; }

        .timeline-date {
            font-size: 11px;
            color: #999;
            margin-bottom: 4px;
        }

        .timeline-title {
            font-size: 13px;
            font-weight: 500;
            color: #333;
            margin-bottom: 4px;
        }

        .timeline-desc {
            font-size: 12px;
            color: #666;
            line-height: 1.5;
        }

        /* Vessel list panel (left side) */
        .list-panel {
            position: absolute;
            top: 56px;
            left: 0;
            width: 320px;
            height: calc(100vh - 56px);
            background: white;
            box-shadow: 4px 0 20px rgba(0,0,0,0.1);
            z-index: 998;
            transform: translateX(-100%);
            transition: transform 0.3s ease;
            display: flex;
            flex-direction: column;
        }

        .list-panel.active { transform: translateX(0); }

        .list-header {
            padding: 16px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .list-title {
            font-weight: 600;
            font-size: 16px;
            color: #333;
        }

        .add-vessel-btn {
            background: #e94560;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
        }

        .add-vessel-btn:hover { background: #d63850; }

        .vessel-list {
            flex: 1;
            overflow-y: auto;
        }

        .vessel-list-item {
            padding: 16px;
            border-bottom: 1px solid #f5f5f5;
            cursor: pointer;
            display: flex;
            gap: 12px;
            align-items: flex-start;
            transition: background 0.2s;
        }

        .vessel-list-item:hover { background: #f8f9fa; }
        .vessel-list-item.active { background: #fff0f3; border-left: 3px solid #e94560; }

        .vessel-list-icon {
            width: 40px; height: 40px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .vessel-list-icon.critical { background: rgba(233,69,96,0.1); color: #e94560; }
        .vessel-list-icon.high { background: rgba(243,156,18,0.1); color: #f39c12; }
        .vessel-list-icon.medium { background: rgba(52,152,219,0.1); color: #3498db; }
        .vessel-list-icon.low { background: rgba(39,174,96,0.1); color: #27ae60; }
        .vessel-list-icon.unknown { background: rgba(149,165,166,0.1); color: #95a5a6; }

        .vessel-list-info { flex: 1; min-width: 0; }
        .vessel-list-name { font-weight: 600; font-size: 14px; color: #333; margin-bottom: 2px; }
        .vessel-list-meta { font-size: 12px; color: #666; }
        .vessel-list-status { font-size: 11px; color: #999; margin-top: 4px; }

        /* Modal styles */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.5);
            backdrop-filter: blur(4px);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
        }

        .modal-overlay.active { display: flex; }

        .modal {
            background: white;
            border-radius: 16px;
            width: 480px;
            max-width: 90vw;
            max-height: 90vh;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .modal-header {
            padding: 20px 24px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title { font-size: 18px; font-weight: 600; color: #333; }

        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            color: #999;
            cursor: pointer;
            padding: 4px;
        }

        .modal-close:hover { color: #333; }

        .modal-body {
            padding: 24px;
            overflow-y: auto;
            max-height: 60vh;
        }

        .form-group { margin-bottom: 20px; }
        .form-label { display: block; font-size: 13px; font-weight: 500; color: #333; margin-bottom: 8px; }

        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 12px 14px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.2s;
        }

        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: #e94560;
        }

        .form-textarea { min-height: 100px; resize: vertical; }
        .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }

        .modal-footer {
            padding: 16px 24px;
            border-top: 1px solid #eee;
            display: flex;
            justify-content: flex-end;
            gap: 12px;
        }

        .btn {
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            border: none;
            transition: all 0.2s;
        }

        .btn-primary { background: #e94560; color: white; }
        .btn-primary:hover { background: #d63850; }
        .btn-secondary { background: #f5f5f5; color: #333; }
        .btn-secondary:hover { background: #eee; }

        /* Ship marker styles */
        .ship-marker {
            width: 24px;
            height: 24px;
            transform-origin: center center;
        }

        .ship-marker svg {
            width: 100%;
            height: 100%;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));
        }

        /* Leaflet customization */
        .leaflet-container { background: #1a1a2e; }

        .leaflet-popup-content-wrapper {
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
        }

        .leaflet-popup-content {
            margin: 0;
            min-width: 200px;
        }

        .popup-content {
            padding: 16px;
        }

        .popup-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 12px;
        }

        .popup-icon {
            width: 36px; height: 36px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .popup-name { font-weight: 600; font-size: 15px; }
        .popup-type { font-size: 12px; color: #666; }

        .popup-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-top: 12px;
        }

        .popup-stat {
            background: #f8f9fa;
            padding: 8px;
            border-radius: 6px;
            text-align: center;
        }

        .popup-stat-value { font-weight: 600; font-size: 14px; }
        .popup-stat-label { font-size: 10px; color: #666; text-transform: uppercase; }

        .popup-btn {
            width: 100%;
            margin-top: 12px;
            padding: 10px;
            background: #e94560;
            color: white;
            border: none;
            border-radius: 6px;
            font-weight: 500;
            cursor: pointer;
        }

        .popup-btn:hover { background: #d63850; }

        /* Map instructions overlay */
        .map-overlay {
            position: absolute;
            bottom: 24px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(26,26,46,0.9);
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 14px;
            z-index: 1000;
            display: none;
        }

        .map-overlay.active { display: block; }

        
        .static-banner {
            position: absolute;
            bottom: 24px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(26,26,46,0.9);
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 13px;
            z-index: 1000;
        }

        .static-banner a { color: #e94560; text-decoration: none; }

        @media (max-width: 768px) {
            .stats-bar { display: none; }
            .vessel-panel, .list-panel { width: 100%; }
        }
    </style>
</head>
<body>
    <div id="map"></div>

    <div class="top-bar">
        <div class="logo">
            <div class="logo-icon">A</div>
            <span>Arsenal Tracker</span>
        </div>

        <div class="search-container">
            <svg class="search-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/>
            </svg>
            <input type="text" class="search-input" id="search-input" placeholder="Search vessels by name, MMSI, or IMO...">
            <div class="search-results" id="search-results"></div>
        </div>

        <div class="stats-bar">
            <div class="stat stat-critical">
                <div class="stat-value">1</div>
                <div class="stat-label">Critical</div>
            </div>
            <div class="stat stat-warning">
                <div class="stat-value">1</div>
                <div class="stat-label">Alerts</div>
            </div>
            <div class="stat stat-info">
                <div class="stat-value" id="live-count">0</div>
                <div class="stat-label">Live</div>
            </div>
            <div class="stat" style="color:#3498db">
                <div class="stat-value" id="stat-live">0</div>
                <div class="stat-label">Live</div>
            </div>
        </div>
    </div>

    <div class="map-controls">
        <button class="control-btn" id="toggle-list" title="Vessel List">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="18" x2="21" y2="18"/>
            </svg>
        </button>
        <button class="control-btn" id="toggle-shipyards" title="Toggle Shipyards">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M3 21h18"/><path d="M5 21V7l8-4v18"/><path d="M19 21V11l-6-3"/>
            </svg>
        </button>
        <button class="control-btn active" id="toggle-live" title="Toggle Live Vessels" style="background:#3498db;color:white;">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"/><path d="M12 6v6l4 2"/>
            </svg>
        </button>
    </div>

    <!-- Vessel List Panel -->
    <div class="list-panel" id="list-panel">
        <div class="list-header">
            <span class="list-title">Tracked Vessels</span>
            <span class="static-badge">Static Demo</span>
        </div>
        <div class="vessel-list" id="vessel-list"></div>
    </div>

    <!-- Vessel Detail Panel -->
    <div class="vessel-panel" id="vessel-panel">
        <div id="vessel-panel-content"></div>
    </div>
    <div class="static-banner">
        Static GitHub Pages demo - <a href="https://github.com/arandomguyhere/AIS_Tracker">View source</a> for full version
    </div>


    

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        const vessels = [
        {
                "id": 1,
                "name": "ZHONG DA 79",
                "mmsi": "413000000",
                "flag_state": "China",
                "vessel_type": "Container Feeder",
                "length_m": 97.0,
                "classification": "confirmed",
                "threat_level": "critical",
                "intel_notes": "Commercial container feeder converted to arsenal ship. Observed with containerized VLS, CIWS, and radar systems at Shanghai shipyard. Underwent refit at Longhai shipyard April-August 2025. Currently moored at industrial pier on Huangpu River, Shanghai. NOT listed in PLAN registry - retains civilian designation despite visible military modifications.",
                "weapons_config": "{\"vls_cells\": 60, \"vls_type\": \"Containerized VLS (4 cells per container)\", \"ciws\": \"Type 1130 30mm\", \"decoys\": \"Type 726\", \"possible_missiles\": [\"CJ-10\", \"YJ-18\", \"YJ-21\"]}",
                "last_lat": 31.2456,
                "last_lon": 121.489,
                "last_heading": 0
        }
];

        const shipyards = [
            {
                        "name": "Hudong-Zhonghua Shipbuilding",
                        "location": "Shanghai",
                        "latitude": 31.3456,
                        "longitude": 121.5234,
                        "geofence_radius_km": 3.0
            },
            {
                        "name": "Longhai Shipyard",
                        "location": "Fujian",
                        "latitude": 24.4456,
                        "longitude": 117.8234,
                        "geofence_radius_km": 2.0
            },
            {
                        "name": "Jiangnan Shipyard",
                        "location": "Shanghai",
                        "latitude": 31.3789,
                        "longitude": 121.5678,
                        "geofence_radius_km": 4.0
            },
            {
                        "name": "Dalian Shipbuilding",
                        "location": "Liaoning",
                        "latitude": 38.9234,
                        "longitude": 121.6345,
                        "geofence_radius_km": 4.0
            },
            {
                        "name": "Shanghai Huangpu River Pier",
                        "location": "Shanghai",
                        "latitude": 31.2456,
                        "longitude": 121.489,
                        "geofence_radius_km": 1.5
            }
];

        const events = [
            {
                        "severity": "critical",
                        "title": "OSINT: ZHONG DA 79 mentioned in United24 Media",
                        "description": "Article from United24 Media correlates with ZHONG DA 79. Weapon systems mentioned: VLS, CIWS, cruise missile. Locations: Shanghai. Key terms: missile, weapon, converted, military, CIWS. [Source: United24 Media]",
                        "event_date": "2025-12-26"
            },
            {
                        "severity": "critical",
                        "title": "OSINT: ZHONG DA 79 mentioned in Naval News",
                        "description": "Article from Naval News correlates with ZHONG DA 79. Weapon systems mentioned: VLS, CIWS, containerized missile. Locations: Fujian. Key terms: arsenal ship, missile, converted, CIWS, VLS. [Source: Naval News]",
                        "event_date": "2025-12-26"
            },
            {
                        "severity": "critical",
                        "title": "OSINT: ZHONG DA 79 mentioned in Newsweek",
                        "description": "Article from Newsweek correlates with ZHONG DA 79. Locations: Shanghai. Key terms: missile, weapon, military, launcher, armed. [Source: Newsweek]",
                        "event_date": "2025-12-26"
            },
            {
                        "severity": "medium",
                        "title": "OSINT: ZHONG DA 79 mentioned in Lloyd's List",
                        "description": "Article from Lloyd's List correlates with ZHONG DA 79. Locations: South China Sea. Key terms: military, cargo. [Source: Lloyd's List]",
                        "event_date": "2025-12-22"
            }
];

        const positions = [
            {
                        "latitude": 24.4456,
                        "longitude": 117.8234
            },
            {
                        "latitude": 26.1234,
                        "longitude": 119.9876
            },
            {
                        "latitude": 28.9876,
                        "longitude": 121.2345
            },
            {
                        "latitude": 31.2456,
                        "longitude": 121.489
            }
];

        const osint = [
            {
                        "source_name": "United24 Media",
                        "title": "Cargo Ship or Warship? China Arms Civilian Vessel With 60 Missiles",
                        "source_url": "https://united24media.com/latest-news/cargo-ship-or-warship-china-arms-civilian-vessel-with-60-missiles-in-plain-sight-14585",
                        "summary": "China converted a civilian container ship into an arsenal ship with 60 containerized missiles."
            },
            {
                        "source_name": "Naval News",
                        "title": "Container Ship Turned Missile Battery Spotted in China",
                        "source_url": "https://www.navalnews.com/naval-news/2025/12/container-ship-turned-missile-battery-spotted-in-china/",
                        "summary": "Naval News analysis of ZHONG DA 79 conversion."
            },
            {
                        "source_name": "Newsweek",
                        "title": "Photos Show Chinese Cargo Ship Armed With Missile Launchers",
                        "source_url": "https://www.newsweek.com/photos-chinese-cargo-ship-missile-launchers-11270114",
                        "summary": "Newsweek coverage with geopolitical context."
            },
            {
                        "source_name": "The War Zone",
                        "title": "Chinese Cargo Ship Packed Full Of Modular Missile Launchers",
                        "source_url": "https://www.twz.com/sea/chinese-cargo-ship-packed-full-of-modular-missile-launchers-emerges",
                        "summary": "Technical analysis of containerized weapons systems."
            }
];

        let map, vesselMarkers = {}, liveVesselMarkers = {}, shipyardMarkers = [], shipyardCircles = [], trackLine = null, showShipyards = true, showLiveVessels = true;
        let liveVessels = [];

        // Load live vessels from JSON file
        async function loadLiveVessels() {
            try {
                const response = await fetch('live_vessels.json?t=' + Date.now());
                if (!response.ok) return;
                const data = await response.json();
                liveVessels = data.vessels || [];
                renderLiveVessels();
                document.getElementById('live-count').textContent = liveVessels.length;
            } catch(e) {
                console.log('No live vessel data available');
            }
        }

        // Render live vessels on map
        function renderLiveVessels() {
            // Clear existing live markers
            Object.values(liveVesselMarkers).forEach(m => map.removeLayer(m));
            liveVesselMarkers = {};

            if (!showLiveVessels) return;

            liveVessels.forEach(v => {
                if (!v.lat || !v.lon) return;
                const color = '#3498db'; // Blue for live vessels
                const marker = L.marker([v.lat, v.lon], {
                    icon: createShipIcon(color, v.heading || v.course || 0)
                }).addTo(map);
                marker.bindPopup(`<div class="popup-content">
                    <div class="popup-name">${v.name || 'MMSI ' + v.mmsi}</div>
                    <div class="popup-type">${v.ship_type || 'Unknown'} ${v.flag || ''}</div>
                    <div class="popup-stats">
                        <div class="popup-stat"><div class="popup-stat-value">${v.lat.toFixed(4)}</div><div class="popup-stat-label">Lat</div></div>
                        <div class="popup-stat"><div class="popup-stat-value">${v.lon.toFixed(4)}</div><div class="popup-stat-label">Lon</div></div>
                        <div class="popup-stat"><div class="popup-stat-value">${v.speed ? v.speed.toFixed(1) : '-'}</div><div class="popup-stat-label">Knots</div></div>
                    </div>
                    <div style="font-size:11px;color:#666;margin-top:8px">MMSI: ${v.mmsi}</div>
                </div>`, { maxWidth: 280 });
                liveVesselMarkers[v.mmsi] = marker;
            });
        }

        // Delete a tracked vessel
        function deleteVessel(id) {
            const idx = vessels.findIndex(v => v.id === id);
            if (idx > -1) {
                if (vesselMarkers[id]) {
                    map.removeLayer(vesselMarkers[id]);
                    delete vesselMarkers[id];
                }
                vessels.splice(idx, 1);
                renderVesselList();
                document.getElementById('vessel-panel').classList.remove('active');
            }
        }

        function createShipIcon(color, heading = 0) {
            return L.divIcon({
                html: `<div class="ship-marker" style="transform: rotate(${heading}deg)"><svg viewBox="0 0 24 24" fill="${color}"><path d="M12 2L4 19h16L12 2z" stroke="white" stroke-width="1"/></svg></div>`,
                className: '', iconSize: [24, 24], iconAnchor: [12, 12]
            });
        }

        function getThreatColor(level) {
            return { critical: '#e94560', high: '#f39c12', medium: '#3498db', low: '#27ae60' }[level] || '#95a5a6';
        }

        function initMap() {
            map = L.map('map', { center: [28, 118], zoom: 5, zoomControl: false });
            L.control.zoom({ position: 'bottomright' }).addTo(map);
            L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', { maxZoom: 19 }).addTo(map);
        }

        function renderVesselList() {
            document.getElementById('vessel-list').innerHTML = vessels.map(v => `
                <div class="vessel-list-item">
                    <div class="vessel-list-icon ${v.threat_level}" onclick="selectVessel(${v.id})">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2L4 19h16L12 2z"/></svg>
                    </div>
                    <div class="vessel-list-info" onclick="selectVessel(${v.id})">
                        <div class="vessel-list-name">${v.name}</div>
                        <div class="vessel-list-meta">${v.flag_state} - ${v.vessel_type}</div>
                        <div class="vessel-list-status">${v.last_lat.toFixed(2)}, ${v.last_lon.toFixed(2)}</div>
                    </div>
                    <button onclick="event.stopPropagation(); deleteVessel(${v.id})" style="background:#e94560;color:white;border:none;border-radius:4px;padding:4px 8px;cursor:pointer;font-size:11px;margin-left:auto;">X</button>
                </div>
            `).join('');
        }

        function renderVesselMarkers() {
            vessels.forEach(v => {
                const marker = L.marker([v.last_lat, v.last_lon], { icon: createShipIcon(getThreatColor(v.threat_level), v.last_heading || 0) }).addTo(map);
                marker.bindPopup(`<div class="popup-content"><div class="popup-header"><div class="popup-icon" style="background:${getThreatColor(v.threat_level)}20;color:${getThreatColor(v.threat_level)}"><svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2L4 19h16L12 2z"/></svg></div><div><div class="popup-name">${v.name}</div><div class="popup-type">${v.flag_state} ${v.vessel_type}</div></div></div><div class="popup-stats"><div class="popup-stat"><div class="popup-stat-value">${v.last_lat.toFixed(4)}</div><div class="popup-stat-label">Lat</div></div><div class="popup-stat"><div class="popup-stat-value">${v.last_lon.toFixed(4)}</div><div class="popup-stat-label">Lon</div></div></div><button class="popup-btn" onclick="selectVessel(${v.id})">View Details</button></div>`, { maxWidth: 300 });
                marker.on('click', () => selectVessel(v.id));
                vesselMarkers[v.id] = marker;
            });
        }

        function renderShipyards() {
            shipyardMarkers.forEach(m => map.removeLayer(m));
            shipyardCircles.forEach(c => map.removeLayer(c));
            shipyardMarkers = []; shipyardCircles = [];
            if (!showShipyards) return;
            shipyards.forEach(s => {
                const marker = L.circleMarker([s.latitude, s.longitude], { radius: 6, fillColor: '#f39c12', color: '#fff', weight: 2, fillOpacity: 0.8 }).addTo(map);
                marker.bindPopup(`<b>${s.name}</b><br>${s.location}`);
                shipyardMarkers.push(marker);
                const circle = L.circle([s.latitude, s.longitude], { radius: s.geofence_radius_km * 1000, color: '#f39c12', fillColor: '#f39c12', fillOpacity: 0.1, weight: 1, dashArray: '4' }).addTo(map);
                shipyardCircles.push(circle);
            });
        }

        function selectVessel(id) {
            const v = vessels.find(x => x.id === id);
            if (!v) return;
            map.setView([v.last_lat, v.last_lon], 8);
            if (trackLine) map.removeLayer(trackLine);
            trackLine = L.polyline(positions.map(p => [p.latitude, p.longitude]), { color: getThreatColor(v.threat_level), weight: 2, opacity: 0.7, dashArray: '6' }).addTo(map);

            let weapons = {}; try { weapons = JSON.parse(v.weapons_config || '{}'); } catch(e) {}
            document.getElementById('vessel-panel-content').innerHTML = `
                <div class="panel-header">
                    <button class="panel-close" onclick="document.getElementById('vessel-panel').classList.remove('active')">&times;</button>
                    <div class="vessel-icon-large" style="background:${getThreatColor(v.threat_level)}20;color:${getThreatColor(v.threat_level)}"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2L4 19h16L12 2z"/></svg></div>
                    <div class="vessel-name">${v.name}</div>
                    <div class="vessel-type">${v.flag_state} - ${v.vessel_type}</div>
                    <div class="threat-indicator threat-${v.threat_level}">${v.threat_level}</div>
                </div>
                <div class="panel-section"><div class="section-title">Position</div><div class="position-display"><div class="coord-box"><div class="coord-label">Latitude</div><div class="coord-value">${v.last_lat.toFixed(4)}</div></div><div class="coord-box"><div class="coord-label">Longitude</div><div class="coord-value">${v.last_lon.toFixed(4)}</div></div></div></div>
                <div class="panel-section"><div class="section-title">Details</div><div class="info-row"><span class="info-label">MMSI</span><span class="info-value">${v.mmsi || '-'}</span></div><div class="info-row"><span class="info-label">Classification</span><span class="info-value">${v.classification}</span></div><div class="info-row"><span class="info-label">Length</span><span class="info-value">${v.length_m}m</span></div></div>
                <div class="panel-section"><div class="section-title">Intelligence</div><div class="intel-box">${v.intel_notes}</div></div>
                <div class="panel-section"><div class="section-title">Weapons</div><div class="weapons-grid">${weapons.vls_cells ? `<div class="weapon-item"><span class="weapon-name">VLS Cells</span><span class="weapon-value">${weapons.vls_cells}</span></div>` : ''}${weapons.ciws ? `<div class="weapon-item"><span class="weapon-name">CIWS</span><span class="weapon-value">${weapons.ciws}</span></div>` : ''}${weapons.decoys ? `<div class="weapon-item"><span class="weapon-name">Decoys</span><span class="weapon-value">${weapons.decoys}</span></div>` : ''}${weapons.possible_missiles ? `<div class="weapon-item"><span class="weapon-name">Missiles</span><span class="weapon-value">${weapons.possible_missiles.join(', ')}</span></div>` : ''}</div></div>
                <div class="panel-section"><div class="section-title">Timeline</div><div class="timeline">${events.slice(0, 8).map(e => `<div class="timeline-item"><div class="timeline-dot severity-${e.severity === 'critical' ? 'critical' : e.severity === 'high' ? 'high' : e.severity === 'medium' ? 'medium' : 'info'}"></div><div class="timeline-date">${new Date(e.event_date).toLocaleDateString()}</div><div class="timeline-title">${e.title}</div><div class="timeline-desc">${e.description}</div></div>`).join('')}</div></div>
                <div class="panel-section"><div class="section-title">OSINT Reports</div>${osint.map(r => `<div style="margin-bottom:12px;padding:12px;background:#f8f9fa;border-radius:8px"><div style="font-size:11px;color:#e94560;text-transform:uppercase;margin-bottom:4px">${r.source_name}</div><a href="${r.source_url}" target="_blank" style="font-weight:500;color:#333;text-decoration:none">${r.title}</a><div style="font-size:12px;color:#666;margin-top:4px">${r.summary}</div></div>`).join('')}</div>`;
            document.getElementById('vessel-panel').classList.add('active');
        }

        const searchInput = document.getElementById('search-input');
        const searchResults = document.getElementById('search-results');
        searchInput.addEventListener('input', e => {
            const q = e.target.value.toLowerCase().trim();
            if (!q) { searchResults.classList.remove('active'); return; }
            const matches = vessels.filter(v => v.name.toLowerCase().includes(q) || (v.mmsi && v.mmsi.includes(q)));
            if (!matches.length) { searchResults.classList.remove('active'); return; }
            searchResults.innerHTML = matches.map(v => `<div class="search-result-item" onclick="selectVessel(${v.id}); searchResults.classList.remove('active'); searchInput.value = '';"><div class="result-icon" style="background:${getThreatColor(v.threat_level)}20;color:${getThreatColor(v.threat_level)}"><svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2L4 19h16L12 2z"/></svg></div><div class="result-info"><div class="result-name">${v.name}</div><div class="result-meta">${v.flag_state} - ${v.mmsi || ''}</div></div></div>`).join('');
            searchResults.classList.add('active');
        });

        document.getElementById('toggle-list').addEventListener('click', () => { document.getElementById('list-panel').classList.toggle('active'); document.getElementById('toggle-list').classList.toggle('active'); });
        document.getElementById('toggle-shipyards').addEventListener('click', () => { showShipyards = !showShipyards; document.getElementById('toggle-shipyards').classList.toggle('active', showShipyards); renderShipyards(); });
        document.addEventListener('keydown', e => { if (e.key === 'Escape') document.getElementById('vessel-panel').classList.remove('active'); });

        document.getElementById('toggle-live').addEventListener('click', () => { showLiveVessels = !showLiveVessels; document.getElementById('toggle-live').classList.toggle('active', showLiveVessels); renderLiveVessels(); });

        document.addEventListener('DOMContentLoaded', () => {
            initMap();
            renderVesselList();
            renderVesselMarkers();
            renderShipyards();
            loadLiveVessels();
            // Auto-refresh live vessels every 10 seconds
            setInterval(loadLiveVessels, 10000);
        });
    </script>
</body>
</html>
